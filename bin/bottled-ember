#!/usr/bin/env node
'use strict';

// This file is intentionally left compatible with older versions of
// node for the following scenario:
// * user runs node 0.12
// * user is still running an older node 0.12 compatible ember-cli locally
// * user unintentionally installs ember-cli latest globally

// Provide a title to the process in `ps`
process.title = 'ember';

const { join, dirname } = require('path');

var resolve = require('resolve');
var logger = require('heimdalljs-logger')('ember-cli:bin');

var basedir = process.cwd();

console.log('im running now in ', basedir);

logger.info('Resolving "ember-cli" from %j...', basedir);

// const cliPath = resolve.sync('bottled-ember-cli');

// console.log({cliPath});

// const Project = require(join(__dirname, '../models/project'));

// console.log({Project});

// Project._closestSync = Project.closestSync;

// Project.closestSync = (pathName, _ui, _cli) => {
//   return Project._closestSync(__dirname, _ui, _cli);
// }



// require.cache[require.resolve(join(dirname(cliPath), '../models/project'))].exports.prototype.isEmberCLIProject = function isEmberCLIProject() {
//   console.log('in my override');
//   return true;
// };

const cli = require(join(__dirname, '../'));

console.log('blah!!!!');

logger.info('Starting "ember-cli"...');
cli({
  cliArgs: ['serve', '--output-path=bottled-dist'],
  inputStream: process.stdin,
  outputStream: process.stdout,
  errorStream: process.stderr
}).then(function(result) {
  var exit = require('exit');
  var exitCode = typeof result === 'object' ? result.exitCode : result;

  logger.info('Quitting "ember-cli" with exit code: %j', exitCode);
  exit(exitCode);
});
